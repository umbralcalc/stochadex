---
title: "api"
logo: true
---
<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# api

```go
import "github.com/umbralcalc/stochadex/pkg/api"
```

## Index

- [Variables](<#variables>)
- [func Run\(config \*ApiRunConfig, socket \*SocketConfig\)](<#Run>)
- [func RunWithParsedArgs\(args ParsedArgs\)](<#RunWithParsedArgs>)
- [func StepAndServeWebsocket\(generator \*simulator.ConfigGenerator, stepDelay time.Duration, handle string, address string\)](<#StepAndServeWebsocket>)
- [func WriteMainProgram\(args ParsedArgs\) string](<#WriteMainProgram>)
- [type ApiRunConfig](<#ApiRunConfig>)
  - [func LoadApiRunConfigFromYaml\(path string\) \*ApiRunConfig](<#LoadApiRunConfigFromYaml>)
  - [func \(a \*ApiRunConfig\) GetConfigGenerator\(\) \*simulator.ConfigGenerator](<#ApiRunConfig.GetConfigGenerator>)
- [type ApiRunConfigStrings](<#ApiRunConfigStrings>)
  - [func LoadApiRunConfigStringsFromYaml\(path string\) \*ApiRunConfigStrings](<#LoadApiRunConfigStringsFromYaml>)
- [type EmbeddedRunConfig](<#EmbeddedRunConfig>)
- [type EmbeddedRunConfigStrings](<#EmbeddedRunConfigStrings>)
- [type ParsedArgs](<#ParsedArgs>)
  - [func ArgParse\(\) ParsedArgs](<#ArgParse>)
- [type PartitionConfigStrings](<#PartitionConfigStrings>)
- [type RunConfig](<#RunConfig>)
  - [func \(r \*RunConfig\) GetConfigGenerator\(\) \*simulator.ConfigGenerator](<#RunConfig.GetConfigGenerator>)
- [type RunConfigStrings](<#RunConfigStrings>)
- [type SocketConfig](<#SocketConfig>)
  - [func LoadSocketConfigFromYaml\(path string\) \*SocketConfig](<#LoadSocketConfigFromYaml>)
  - [func \(s \*SocketConfig\) Active\(\) bool](<#SocketConfig.Active>)


## Variables

<a name="ApiCodeTemplate"></a>
ApiCodeTemplate is the Go source template used to generate a runnable temporary main program that executes the requested run configuration.

```go
var ApiCodeTemplate = `package main

import (
	"github.com/umbralcalc/stochadex/pkg/api"
	"github.com/umbralcalc/stochadex/pkg/simulator"
	{{.ExtraPackages}}
)

func main() {
	config := api.LoadApiRunConfigFromYaml("{{.ConfigFile}}")
	socket := api.LoadSocketConfigFromYaml("{{.SocketFile}}")
	{{.ExtraVars}}
	{{.ExtraCode}}
    api.Run(config, socket)
}`
```

<a name="Run"></a>

## func [Run](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/run.go#L64>)

```go
func Run(config *ApiRunConfig, socket *SocketConfig)
```

Run executes the configured simulation. If a websocket socket is active, it serves real\-time updates; otherwise, it runs to completion offline.

<a name="RunWithParsedArgs"></a>

## func [RunWithParsedArgs](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/run.go#L84>)

```go
func RunWithParsedArgs(args ParsedArgs)
```

RunWithParsedArgs generates a temporary main program from the templated config and executes it via \`go run\`, enabling dynamic iteration wiring.

<a name="StepAndServeWebsocket"></a>

## func [StepAndServeWebsocket](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/run.go#L21-L26>)

```go
func StepAndServeWebsocket(generator *simulator.ConfigGenerator, stepDelay time.Duration, handle string, address string)
```

StepAndServeWebsocket steps a simulation and streams state updates over a websocket using simulator.WebsocketOutputFunction.

Usage hints:

- The HTTP server mounts the websocket at handle and listens on address.
- stepDelay controls the delay between steps in milliseconds.

<a name="WriteMainProgram"></a>

## func [WriteMainProgram](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L294>)

```go
func WriteMainProgram(args ParsedArgs) string
```

WriteMainProgram renders ApiCodeTemplate to a /tmp/\*main.go and returns the file path.

Usage hints:

- The generated program imports extra packages, declares extra variables, and wires iterations per the templated config.

<a name="ApiRunConfig"></a>

## type [ApiRunConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L68-L71>)

ApiRunConfig is the concrete, YAML\-loadable configuration for an API run: a main RunConfig and optional embedded runs.

```go
type ApiRunConfig struct {
    Main     RunConfig           `yaml:"main"`
    Embedded []EmbeddedRunConfig `yaml:"embedded,omitempty"`
}
```

<a name="LoadApiRunConfigFromYaml"></a>

### func [LoadApiRunConfigFromYaml](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L90>)

```go
func LoadApiRunConfigFromYaml(path string) *ApiRunConfig
```

LoadApiRunConfigFromYaml loads ApiRunConfig from YAML and initialises partition defaults.

<a name="ApiRunConfig.GetConfigGenerator"></a>

### func \(\*ApiRunConfig\) [GetConfigGenerator](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L76>)

```go
func (a *ApiRunConfig) GetConfigGenerator() *simulator.ConfigGenerator
```

GetConfigGenerator returns a ConfigGenerator for the main run. Any partition whose name matches an embedded run is replaced by an embedded simulation iteration wired to that embedded run.

<a name="ApiRunConfigStrings"></a>

## type [ApiRunConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L113-L116>)

ApiRunConfigStrings is the string\-templated configuration used to generate code for an API run \(imports, variables, iteration factories\).

```go
type ApiRunConfigStrings struct {
    Main     RunConfigStrings           `yaml:"main"`
    Embedded []EmbeddedRunConfigStrings `yaml:"embedded,omitempty"`
}
```

<a name="LoadApiRunConfigStringsFromYaml"></a>

### func [LoadApiRunConfigStringsFromYaml](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L139>)

```go
func LoadApiRunConfigStringsFromYaml(path string) *ApiRunConfigStrings
```

LoadApiRunConfigStringsFromYaml loads the templated config from YAML and validates it for code generation.

<a name="EmbeddedRunConfig"></a>

## type [EmbeddedRunConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L47-L50>)

EmbeddedRunConfig names and embeds an additional RunConfig that can be wired into a partition in the main run.

```go
type EmbeddedRunConfig struct {
    Name string    `yaml:"name"`
    Run  RunConfig `yaml:",inline"`
}
```

<a name="EmbeddedRunConfigStrings"></a>

## type [EmbeddedRunConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L61-L64>)

EmbeddedRunConfigStrings names and provides string\-templated inputs for an embedded simulation run.

```go
type EmbeddedRunConfigStrings struct {
    Name string           `yaml:"name"`
    Run  RunConfigStrings `yaml:",inline"`
}
```

<a name="ParsedArgs"></a>

## type [ParsedArgs](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/parsing.go#L13-L17>)

ParsedArgs bundles CLI\-derived inputs for running the API. Includes the YAML config path, optional socket config path, and the string\-templated configuration used to generate a runnable main.

```go
type ParsedArgs struct {
    ConfigStrings *ApiRunConfigStrings
    ConfigFile    string
    SocketFile    string
}
```

<a name="ArgParse"></a>

### func [ArgParse](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/parsing.go#L21>)

```go
func ArgParse() ParsedArgs
```

ArgParse parses CLI flags into a ParsedArgs, loading ApiRunConfigStrings from the provided YAML path for template hydration.

<a name="PartitionConfigStrings"></a>

## type [PartitionConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L20-L25>)

PartitionConfigStrings describes a partition in its string\-templated form for code generation.

Usage hints:

- Iteration is a Go expression constructing the iteration \(factory call\).
- ExtraPackages lists import paths required by Iteration or ExtraVars.
- ExtraVars declares ad\-hoc variables injected into the generated main.

```go
type PartitionConfigStrings struct {
    Name          string              `yaml:"name"`
    Iteration     string              `yaml:"iteration,omitempty"`
    ExtraPackages []string            `yaml:"extra_packages,omitempty"`
    ExtraVars     []map[string]string `yaml:"extra_vars,omitempty"`
}
```

<a name="RunConfig"></a>

## type [RunConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L29-L32>)

RunConfig is the concrete, YAML\-loadable configuration for a run: partitions plus a SimulationConfig.

```go
type RunConfig struct {
    Partitions []simulator.PartitionConfig `yaml:"partitions"`
    Simulation simulator.SimulationConfig  `yaml:"-"`
}
```

<a name="RunConfig.GetConfigGenerator"></a>

### func \(\*RunConfig\) [GetConfigGenerator](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L36>)

```go
func (r *RunConfig) GetConfigGenerator() *simulator.ConfigGenerator
```

GetConfigGenerator constructs a ConfigGenerator preloaded with the run's SimulationConfig and Partitions.

<a name="RunConfigStrings"></a>

## type [RunConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L54-L57>)

RunConfigStrings provides the string\-templated inputs required to generate a runnable main for a simulation run.

```go
type RunConfigStrings struct {
    Partitions []PartitionConfigStrings          `yaml:"partitions"`
    Simulation simulator.SimulationConfigStrings `yaml:"simulation"`
}
```

<a name="SocketConfig"></a>

## type [SocketConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/socket.go#L12-L16>)

SocketConfig configures an optional real\-time websocket used to stream simulation updates.

```go
type SocketConfig struct {
    Address          string `yaml:"address"`
    Handle           string `yaml:"handle"`
    MillisecondDelay uint64 `yaml:"millisecond_delay"`
}
```

<a name="LoadSocketConfigFromYaml"></a>

### func [LoadSocketConfigFromYaml](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/socket.go#L26>)

```go
func LoadSocketConfigFromYaml(path string) *SocketConfig
```

LoadSocketConfigFromYaml loads a SocketConfig from YAML. If the path is empty, it returns a zero\-valued config and logs that sockets are disabled.

<a name="SocketConfig.Active"></a>

### func \(\*SocketConfig\) [Active](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/socket.go#L19>)

```go
func (s *SocketConfig) Active() bool
```

Active reports whether the websocket server should be started.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
