---
title: "api"
logo: true
---
<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# api

```go
import "github.com/umbralcalc/stochadex/pkg/api"
```

## Index

- [Variables](<#variables>)
- [func Run\(config \*ApiRunConfig, socket \*SocketConfig\)](<#Run>)
- [func RunWithParsedArgs\(args ParsedArgs\)](<#RunWithParsedArgs>)
- [func StepAndServeWebsocket\(generator \*simulator.ConfigGenerator, stepDelay time.Duration, handle string, address string\)](<#StepAndServeWebsocket>)
- [func WriteMainProgram\(args ParsedArgs\) string](<#WriteMainProgram>)
- [type ApiRunConfig](<#ApiRunConfig>)
  - [func LoadApiRunConfigFromYaml\(path string\) \*ApiRunConfig](<#LoadApiRunConfigFromYaml>)
  - [func \(a \*ApiRunConfig\) GetConfigGenerator\(\) \*simulator.ConfigGenerator](<#ApiRunConfig.GetConfigGenerator>)
- [type ApiRunConfigStrings](<#ApiRunConfigStrings>)
  - [func LoadApiRunConfigStringsFromYaml\(path string\) \*ApiRunConfigStrings](<#LoadApiRunConfigStringsFromYaml>)
- [type EmbeddedRunConfig](<#EmbeddedRunConfig>)
- [type EmbeddedRunConfigStrings](<#EmbeddedRunConfigStrings>)
- [type ParsedArgs](<#ParsedArgs>)
  - [func ArgParse\(\) ParsedArgs](<#ArgParse>)
- [type PartitionConfigStrings](<#PartitionConfigStrings>)
- [type RunConfig](<#RunConfig>)
  - [func \(r \*RunConfig\) GetConfigGenerator\(\) \*simulator.ConfigGenerator](<#RunConfig.GetConfigGenerator>)
- [type RunConfigStrings](<#RunConfigStrings>)
- [type SocketConfig](<#SocketConfig>)
  - [func LoadSocketConfigFromYaml\(path string\) \*SocketConfig](<#LoadSocketConfigFromYaml>)
  - [func \(s \*SocketConfig\) Active\(\) bool](<#SocketConfig.Active>)


## Variables

<a name="ApiCodeTemplate"></a>
ApiCodeTemplate is a string representing the template for the API run code.

```go
var ApiCodeTemplate = `package main

import (
	"github.com/umbralcalc/stochadex/pkg/api"
	"github.com/umbralcalc/stochadex/pkg/simulator"
	{{.ExtraPackages}}
)

func main() {
	config := api.LoadApiRunConfigFromYaml("{{.ConfigFile}}")
	socket := api.LoadSocketConfigFromYaml("{{.SocketFile}}")
	{{.ExtraVars}}
	{{.ExtraCode}}
    api.Run(config, socket)
}`
```

<a name="Run"></a>

## func [Run](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/run.go#L58>)

```go
func Run(config *ApiRunConfig, socket *SocketConfig)
```

Run the the main run routine for the API.

<a name="RunWithParsedArgs"></a>

## func [RunWithParsedArgs](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/run.go#L78>)

```go
func RunWithParsedArgs(args ParsedArgs)
```

RunWithParsedArgs takes in the outputs from ArgParse and runs the stochadex with these configurations.

<a name="StepAndServeWebsocket"></a>

## func [StepAndServeWebsocket](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/run.go#L17-L22>)

```go
func StepAndServeWebsocket(generator *simulator.ConfigGenerator, stepDelay time.Duration, handle string, address string)
```

StepAndServeWebsocket runs a simulation while serving a websocket with the simulator.WebsocketOutputFunction.

<a name="WriteMainProgram"></a>

## func [WriteMainProgram](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L286>)

```go
func WriteMainProgram(args ParsedArgs) string
```

WriteMainProgram writes string representations of various types of data to a template /tmp/\*main.go file ready for runtime execution in this \*main.go.

<a name="ApiRunConfig"></a>

## type [ApiRunConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L64-L67>)

ApiRunConfig is the yaml\-loadable config which specifies the loadable config data within the generated code for an API run.

```go
type ApiRunConfig struct {
    Main     RunConfig           `yaml:"main"`
    Embedded []EmbeddedRunConfig `yaml:"embedded,omitempty"`
}
```

<a name="LoadApiRunConfigFromYaml"></a>

### func [LoadApiRunConfigFromYaml](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L87>)

```go
func LoadApiRunConfigFromYaml(path string) *ApiRunConfig
```

LoadApiRunConfigFromYaml creates a new ApiRunConfig from a provided yaml path.

<a name="ApiRunConfig.GetConfigGenerator"></a>

### func \(\*ApiRunConfig\) [GetConfigGenerator](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L73>)

```go
func (a *ApiRunConfig) GetConfigGenerator() *simulator.ConfigGenerator
```

GetConfigGenerator returns a config generator which has been configured to produce the settings and implementations based on the configured fields of the main RunConfig. This method also takes into account the mappings of embedded simulation runs into the main run.

<a name="ApiRunConfigStrings"></a>

## type [ApiRunConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L110-L113>)

ApiRunConfigStrings is the yaml\-loadable config which specifies the templating inputs for an API run.

```go
type ApiRunConfigStrings struct {
    Main     RunConfigStrings           `yaml:"main"`
    Embedded []EmbeddedRunConfigStrings `yaml:"embedded,omitempty"`
}
```

<a name="LoadApiRunConfigStringsFromYaml"></a>

### func [LoadApiRunConfigStringsFromYaml](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L136>)

```go
func LoadApiRunConfigStringsFromYaml(path string) *ApiRunConfigStrings
```

LoadApiRunConfigStringsFromYaml creates a new ApiRunConfigStrings from a provided yaml path.

<a name="EmbeddedRunConfig"></a>

## type [EmbeddedRunConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L43-L46>)

EmbeddedRunConfig is the yaml\-loadable config which consists of all the necessary config data for an embedded simulation run.

```go
type EmbeddedRunConfig struct {
    Name string    `yaml:"name"`
    Run  RunConfig `yaml:",inline"`
}
```

<a name="EmbeddedRunConfigStrings"></a>

## type [EmbeddedRunConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L57-L60>)

EmbeddedRunConfigStrings is the yaml\-loadable config which consists of all the necessary templating inputs for an embedded simulation run.

```go
type EmbeddedRunConfigStrings struct {
    Name string           `yaml:"name"`
    Run  RunConfigStrings `yaml:",inline"`
}
```

<a name="ParsedArgs"></a>

## type [ParsedArgs](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/parsing.go#L12-L16>)

ParsedArgs contains the information that needs to pass from the CLI to the runner in order to run the API.

```go
type ParsedArgs struct {
    ConfigStrings *ApiRunConfigStrings
    ConfigFile    string
    SocketFile    string
}
```

<a name="ArgParse"></a>

### func [ArgParse](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/parsing.go#L20>)

```go
func ArgParse() ParsedArgs
```

ArgParse builds the configs parsed as args to the stochadex binary and also retrieves other args.

<a name="PartitionConfigStrings"></a>

## type [PartitionConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L15-L20>)

PartitionConfigStrings holds the string Iteration implementations and the potential to define extra packages and variables in configuration.

```go
type PartitionConfigStrings struct {
    Name          string              `yaml:"name"`
    Iteration     string              `yaml:"iteration,omitempty"`
    ExtraPackages []string            `yaml:"extra_packages,omitempty"`
    ExtraVars     []map[string]string `yaml:"extra_vars,omitempty"`
}
```

<a name="RunConfig"></a>

## type [RunConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L24-L27>)

RunConfig is the yaml\-loadable config which consists of all the necessary config data for a simulation run.

```go
type RunConfig struct {
    Partitions []simulator.PartitionConfig `yaml:"partitions"`
    Simulation simulator.SimulationConfig  `yaml:"-"`
}
```

<a name="RunConfig.GetConfigGenerator"></a>

### func \(\*RunConfig\) [GetConfigGenerator](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L32>)

```go
func (r *RunConfig) GetConfigGenerator() *simulator.ConfigGenerator
```

GetConfigGenerator returns a config generator which has been configured to produce the settings and implementations based on the configured fields of the RunConfig.

<a name="RunConfigStrings"></a>

## type [RunConfigStrings](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/program.go#L50-L53>)

RunConfigStrings is the yaml\-loadable config which consists of all the necessary templating inputs for a simulation run.

```go
type RunConfigStrings struct {
    Partitions []PartitionConfigStrings          `yaml:"partitions"`
    Simulation simulator.SimulationConfigStrings `yaml:"simulation"`
}
```

<a name="SocketConfig"></a>

## type [SocketConfig](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/socket.go#L12-L16>)

SocketConfig is a yaml\-loadable config for the real\-time websocket connection to the simulation.

```go
type SocketConfig struct {
    Address          string `yaml:"address"`
    Handle           string `yaml:"handle"`
    MillisecondDelay uint64 `yaml:"millisecond_delay"`
}
```

<a name="LoadSocketConfigFromYaml"></a>

### func [LoadSocketConfigFromYaml](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/socket.go#L26>)

```go
func LoadSocketConfigFromYaml(path string) *SocketConfig
```

LoadSocketConfigFromYaml creates a new SocketConfig from a provided yaml path. If the path is an empty string this outputs a SocketConfig with empty fields.

<a name="SocketConfig.Active"></a>

### func \(\*SocketConfig\) [Active](<https://github.com/umbralcalc/stochadex/blob/main/pkg/api/socket.go#L19>)

```go
func (s *SocketConfig) Active() bool
```

Active determines whether or not the websocket should be active.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
