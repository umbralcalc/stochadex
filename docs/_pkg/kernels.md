---
title: "kernels"
logo: true
---
<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# kernels

```go
import "github.com/umbralcalc/stochadex/pkg/kernels"
```

Package kernels provides integration kernels for time\-weighted aggregation and state\-distance weighting in stochadex simulations. These kernels define how historical data points are weighted when computing aggregated statistics over time or when measuring similarity between states.

Key Features:

- Time\-based weighting kernels \(exponential, periodic, constant\)
- State\-distance kernels \(Gaussian, instantaneous\)
- Custom kernel implementations for specialized weighting schemes
- Integration with aggregation functions for rolling statistics

Mathematical Background: Integration kernels define weighting functions w\(t\-s\) for aggregating historical data points. Common patterns include:

- Exponential decay: w\(t\-s\) = exp\(\-λ\(t\-s\)\)
- Gaussian weighting: w\(t\-s\) = exp\(\-\(t\-s\)²/\(2σ²\)\)
- State distance: w\(x,y\) = exp\(\-||x\-y||²/\(2σ²\)\)

Design Philosophy: Kernels are designed to be composable and efficient, providing standardized interfaces for time and state weighting. They enable flexible aggregation schemes while maintaining good performance characteristics.

Usage Patterns:

- Rolling window statistics with time decay
- State similarity measurements for clustering
- Temporal aggregation with customizable weighting
- Feature engineering with distance\-based weighting

## Index

- [type BinnedIntegrationKernel](<#BinnedIntegrationKernel>)
  - [func \(b \*BinnedIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#BinnedIntegrationKernel.Configure>)
  - [func \(b \*BinnedIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#BinnedIntegrationKernel.Evaluate>)
  - [func \(b \*BinnedIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#BinnedIntegrationKernel.SetParams>)
- [type ConstantIntegrationKernel](<#ConstantIntegrationKernel>)
  - [func \(c \*ConstantIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#ConstantIntegrationKernel.Configure>)
  - [func \(c \*ConstantIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#ConstantIntegrationKernel.Evaluate>)
  - [func \(c \*ConstantIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#ConstantIntegrationKernel.SetParams>)
- [type ExponentialIntegrationKernel](<#ExponentialIntegrationKernel>)
  - [func \(e \*ExponentialIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#ExponentialIntegrationKernel.Configure>)
  - [func \(e \*ExponentialIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#ExponentialIntegrationKernel.Evaluate>)
  - [func \(e \*ExponentialIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#ExponentialIntegrationKernel.SetParams>)
- [type GaussianStateIntegrationKernel](<#GaussianStateIntegrationKernel>)
  - [func \(g \*GaussianStateIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#GaussianStateIntegrationKernel.Configure>)
  - [func \(g \*GaussianStateIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#GaussianStateIntegrationKernel.Evaluate>)
  - [func \(g \*GaussianStateIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#GaussianStateIntegrationKernel.SetParams>)
- [type InstantaneousIntegrationKernel](<#InstantaneousIntegrationKernel>)
  - [func \(i \*InstantaneousIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#InstantaneousIntegrationKernel.Configure>)
  - [func \(i \*InstantaneousIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#InstantaneousIntegrationKernel.Evaluate>)
  - [func \(i \*InstantaneousIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#InstantaneousIntegrationKernel.SetParams>)
- [type IntegrationKernel](<#IntegrationKernel>)
- [type PeriodicIntegrationKernel](<#PeriodicIntegrationKernel>)
  - [func \(p \*PeriodicIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#PeriodicIntegrationKernel.Configure>)
  - [func \(p \*PeriodicIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#PeriodicIntegrationKernel.Evaluate>)
  - [func \(p \*PeriodicIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#PeriodicIntegrationKernel.SetParams>)
- [type ProductIntegrationKernel](<#ProductIntegrationKernel>)
  - [func \(p \*ProductIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#ProductIntegrationKernel.Configure>)
  - [func \(p \*ProductIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#ProductIntegrationKernel.Evaluate>)
  - [func \(p \*ProductIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#ProductIntegrationKernel.SetParams>)
- [type TDistributionStateIntegrationKernel](<#TDistributionStateIntegrationKernel>)
  - [func \(t \*TDistributionStateIntegrationKernel\) Configure\(partitionIndex int, settings \*simulator.Settings\)](<#TDistributionStateIntegrationKernel.Configure>)
  - [func \(t \*TDistributionStateIntegrationKernel\) Evaluate\(currentState \[\]float64, pastState \[\]float64, currentTime float64, pastTime float64\) float64](<#TDistributionStateIntegrationKernel.Evaluate>)
  - [func \(t \*TDistributionStateIntegrationKernel\) SetParams\(params \*simulator.Params\)](<#TDistributionStateIntegrationKernel.SetParams>)


<a name="BinnedIntegrationKernel"></a>

## type [BinnedIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/binned.go#L13-L16>)

BinnedIntegrationKernel outputs piecewise\-constant weights in time.

Usage hints:

- Provide "bin\_values" and "bin\_stepsize"; index is floor\(\(t\_now \- t\_past\)/stepsize\).

```go
type BinnedIntegrationKernel struct {
    // contains filtered or unexported fields
}
```

<a name="BinnedIntegrationKernel.Configure"></a>

### func \(\*BinnedIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/binned.go#L18-L21>)

```go
func (b *BinnedIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="BinnedIntegrationKernel.Evaluate"></a>

### func \(\*BinnedIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/binned.go#L31-L36>)

```go
func (b *BinnedIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="BinnedIntegrationKernel.SetParams"></a>

### func \(\*BinnedIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/binned.go#L24-L26>)

```go
func (b *BinnedIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="ConstantIntegrationKernel"></a>

## type [ConstantIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/constant.go#L11>)

ConstantIntegrationKernel returns 1.0 for every sample.

Usage hints:

- Use to compute simple \(unweighted\) sums or means.

```go
type ConstantIntegrationKernel struct{}
```

<a name="ConstantIntegrationKernel.Configure"></a>

### func \(\*ConstantIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/constant.go#L13-L16>)

```go
func (c *ConstantIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="ConstantIntegrationKernel.Evaluate"></a>

### func \(\*ConstantIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/constant.go#L24-L29>)

```go
func (c *ConstantIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="ConstantIntegrationKernel.SetParams"></a>

### func \(\*ConstantIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/constant.go#L19-L21>)

```go
func (c *ConstantIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="ExponentialIntegrationKernel"></a>

## type [ExponentialIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/exponential.go#L14-L16>)

ExponentialIntegrationKernel applies exponential decay over time.

Usage hints:

- Provide "exponential\_weighting\_timescale"; weight = exp\(\(t\_past \- t\_now\)/tau\).
- Suitable for recency\-weighted means.

```go
type ExponentialIntegrationKernel struct {
    // contains filtered or unexported fields
}
```

<a name="ExponentialIntegrationKernel.Configure"></a>

### func \(\*ExponentialIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/exponential.go#L18-L21>)

```go
func (e *ExponentialIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="ExponentialIntegrationKernel.Evaluate"></a>

### func \(\*ExponentialIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/exponential.go#L30-L35>)

```go
func (e *ExponentialIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="ExponentialIntegrationKernel.SetParams"></a>

### func \(\*ExponentialIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/exponential.go#L24-L26>)

```go
func (e *ExponentialIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="GaussianStateIntegrationKernel"></a>

## type [GaussianStateIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/gaussian_state.go#L68-L71>)

GaussianStateIntegrationKernel implements a Gaussian state\-distance kernel for weighting historical samples based on their distance from the current state.

This kernel computes weights using a multivariate Gaussian distribution, where the weight decreases exponentially with the Mahalanobis distance between the current and historical states. It's particularly useful for state\-space aggregation and similarity\-based weighting.

Mathematical Background: The Gaussian kernel computes weights using the multivariate Gaussian density:

```
w(x_current, x_past) = exp(-0.5 * (x_current - x_past)^T * Σ^{-1} * (x_current - x_past)) / sqrt(det(Σ))
```

where Σ is the covariance matrix defining the shape and scale of the weighting.

Key Properties:

- Mahalanobis distance: d² = \(x\_current \- x\_past\)^T \* Σ^\{\-1\} \* \(x\_current \- x\_past\)
- Weight range: w ∈ \[0, 1/sqrt\(det\(Σ\)\)\]
- Maximum weight: w\_max = 1/sqrt\(det\(Σ\)\) when states are identical
- Decay rate: Controlled by eigenvalues of Σ \(larger eigenvalues = slower decay\)

Applications:

- State\-space clustering and similarity weighting
- Non\-parametric density estimation
- Adaptive aggregation based on state similarity
- Anomaly detection through distance weighting
- Multi\-dimensional state space analysis

Configuration:

- Provide "covariance\_matrix" parameter as a flattened symmetric matrix \(row\-major order\)
- Matrix must be positive definite \(all eigenvalues \> 0\)
- Matrix dimension must match state vector dimension

Example:

```
// Configure kernel for 2D state space with covariance matrix
// Σ = [[1.0, 0.5], [0.5, 1.0]] (correlated dimensions)
covariance := []float64{1.0, 0.5, 0.5, 1.0} // row-major flattened
params.Set("covariance_matrix", covariance)

kernel := &GaussianStateIntegrationKernel{}
kernel.Configure(0, settings)
kernel.SetParams(params)

// Weight for similar states will be high, dissimilar states low
weight := kernel.Evaluate(currentState, pastState, currentTime, pastTime)
```

Performance:

- O\(d²\) setup cost for Cholesky decomposition where d is state dimension
- O\(d²\) evaluation cost for matrix\-vector operations
- Memory usage: O\(d²\) for storing Cholesky decomposition
- Efficient for moderate dimensions \(\< 100\)

Error Handling:

- Panics if covariance matrix is not positive definite
- Panics if matrix dimension doesn't match state dimension
- Panics if matrix is not square or symmetric

```go
type GaussianStateIntegrationKernel struct {
    // contains filtered or unexported fields
}
```

<a name="GaussianStateIntegrationKernel.Configure"></a>

### func \(\*GaussianStateIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/gaussian_state.go#L73-L76>)

```go
func (g *GaussianStateIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="GaussianStateIntegrationKernel.Evaluate"></a>

### func \(\*GaussianStateIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/gaussian_state.go#L91-L96>)

```go
func (g *GaussianStateIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="GaussianStateIntegrationKernel.SetParams"></a>

### func \(\*GaussianStateIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/gaussian_state.go#L79>)

```go
func (g *GaussianStateIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="InstantaneousIntegrationKernel"></a>

## type [InstantaneousIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/instantaneous.go#L12>)

InstantaneousIntegrationKernel returns 1.0 for the most recent sample and 0.0 otherwise.

Usage hints:

- Useful to select only the latest value when aggregating.

```go
type InstantaneousIntegrationKernel struct{}
```

<a name="InstantaneousIntegrationKernel.Configure"></a>

### func \(\*InstantaneousIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/instantaneous.go#L14-L17>)

```go
func (i *InstantaneousIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="InstantaneousIntegrationKernel.Evaluate"></a>

### func \(\*InstantaneousIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/instantaneous.go#L25-L30>)

```go
func (i *InstantaneousIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="InstantaneousIntegrationKernel.SetParams"></a>

### func \(\*InstantaneousIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/instantaneous.go#L20-L22>)

```go
func (i *InstantaneousIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="IntegrationKernel"></a>

## type [IntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/interface.go#L84-L93>)

IntegrationKernel defines the interface for time/state weighting kernels used when aggregating over historical data in simulations.

Integration kernels provide a standardized way to weight historical data points when computing aggregated statistics. They enable flexible temporal and spatial weighting schemes that can be customized for specific aggregation needs.

Mathematical Concept: Integration kernels define weighting functions w\(current, past\) that determine how much influence a historical data point has on the current aggregation. Common patterns include:

- Time\-based weighting: w\(t\_current, t\_past\) = f\(t\_current \- t\_past\)
- State\-based weighting: w\(x\_current, x\_past\) = f\(||x\_current \- x\_past||\)
- Hybrid weighting: w\(current, past\) = f\(time\_diff, state\_diff\)

Interface Methods:

- Configure: Initialize kernel with simulation settings \(called once per partition\)
- SetParams: Update kernel parameters from simulation context \(called each step\)
- Evaluate: Compute weight for a historical sample \(called for each aggregation\)

Weight Properties:

- Weights must be non\-negative: w\(current, past\) ≥ 0
- Weights should be normalized for consistent aggregation scales
- Zero weights indicate no influence from that historical sample

Common Kernel Types:

- ExponentialIntegrationKernel: Exponential time decay w\(t\) = exp\(\-λt\)
- GaussianStateIntegrationKernel: State distance weighting w\(x,y\) = exp\(\-||x\-y||²/2σ²\)
- InstantaneousIntegrationKernel: No weighting, w = 1 for current, 0 for past
- PeriodicIntegrationKernel: Periodic time weighting for seasonal patterns

Example Usage:

```
kernel := &ExponentialIntegrationKernel{}
kernel.Configure(0, settings)
kernel.SetParams(params) // params contains decay rate λ

// Evaluate weight for a sample from 1.0 time units ago
weight := kernel.Evaluate(currentState, pastState, 5.0, 4.0)
// weight = exp(-λ * 1.0)
```

Performance Considerations:

- Evaluate is called frequently during aggregation
- Implementations should be optimized for repeated calls
- Consider caching expensive computations in SetParams
- Avoid memory allocations in Evaluate method

Related Types:

- See analysis.AppliedAggregation for usage in data aggregation
- See ExponentialIntegrationKernel for exponential decay weighting
- See GaussianStateIntegrationKernel for state\-distance weighting

```go
type IntegrationKernel interface {
    Configure(partitionIndex int, settings *simulator.Settings)
    SetParams(params *simulator.Params)
    Evaluate(
        currentState []float64,
        pastState []float64,
        currentTime float64,
        pastTime float64,
    ) float64
}
```

<a name="PeriodicIntegrationKernel"></a>

## type [PeriodicIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/periodic.go#L14-L16>)

PeriodicIntegrationKernel applies periodic \(circular\) time weighting.

Usage hints:

- Provide "periodic\_weighting\_timescale"; weight = exp\(\-2 sin^2\(dt/2\)/tau^2\).
- Useful for daily/weekly seasonality.

```go
type PeriodicIntegrationKernel struct {
    // contains filtered or unexported fields
}
```

<a name="PeriodicIntegrationKernel.Configure"></a>

### func \(\*PeriodicIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/periodic.go#L18-L21>)

```go
func (p *PeriodicIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="PeriodicIntegrationKernel.Evaluate"></a>

### func \(\*PeriodicIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/periodic.go#L31-L36>)

```go
func (p *PeriodicIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="PeriodicIntegrationKernel.SetParams"></a>

### func \(\*PeriodicIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/periodic.go#L24-L26>)

```go
func (p *PeriodicIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="ProductIntegrationKernel"></a>

## type [ProductIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/product.go#L12-L15>)

ProductIntegrationKernel multiplies two kernels to form a composite weight.

Usage hints:

- Configure and SetParams will be forwarded to both KernelA and KernelB.
- Useful to combine, e.g., temporal and state\-distance weightings.

```go
type ProductIntegrationKernel struct {
    KernelA IntegrationKernel
    KernelB IntegrationKernel
}
```

<a name="ProductIntegrationKernel.Configure"></a>

### func \(\*ProductIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/product.go#L17-L20>)

```go
func (p *ProductIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="ProductIntegrationKernel.Evaluate"></a>

### func \(\*ProductIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/product.go#L32-L37>)

```go
func (p *ProductIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="ProductIntegrationKernel.SetParams"></a>

### func \(\*ProductIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/product.go#L25-L27>)

```go
func (p *ProductIntegrationKernel) SetParams(params *simulator.Params)
```



<a name="TDistributionStateIntegrationKernel"></a>

## type [TDistributionStateIntegrationKernel](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/t_distribution_state.go#L18-L22>)

TDistributionStateIntegrationKernel applies a multivariate t kernel using an input scale matrix and degrees of freedom.

Usage hints:

- Provide "scale\_matrix" as a flattened symmetric matrix \(row\-major\) and "degrees\_of\_freedom".
- Weights are proportional to \(1 \+ \(x\-μ\)^T S^\{\-1\} \(x\-μ\)/ν\)^\{\-\(d\+ν\)/2\} / det\(S\).

```go
type TDistributionStateIntegrationKernel struct {
    // contains filtered or unexported fields
}
```

<a name="TDistributionStateIntegrationKernel.Configure"></a>

### func \(\*TDistributionStateIntegrationKernel\) [Configure](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/t_distribution_state.go#L24-L27>)

```go
func (t *TDistributionStateIntegrationKernel) Configure(partitionIndex int, settings *simulator.Settings)
```



<a name="TDistributionStateIntegrationKernel.Evaluate"></a>

### func \(\*TDistributionStateIntegrationKernel\) [Evaluate](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/t_distribution_state.go#L43-L48>)

```go
func (t *TDistributionStateIntegrationKernel) Evaluate(currentState []float64, pastState []float64, currentTime float64, pastTime float64) float64
```



<a name="TDistributionStateIntegrationKernel.SetParams"></a>

### func \(\*TDistributionStateIntegrationKernel\) [SetParams](<https://github.com/umbralcalc/stochadex/blob/main/pkg/kernels/t_distribution_state.go#L30>)

```go
func (t *TDistributionStateIntegrationKernel) SetParams(params *simulator.Params)
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
